Environmental Research LettersLETTER OPEN ACCESSEstimating and understanding crop yields with explainable deep learningin the Indian Wheat BeltTo cite this article: Aleksandra Wolanin et al 2020 Environ. Res. Lett. 15 024019 View the article online for updates and enhancements.This content was downloaded from IP address 174.4.232.78 on 18/05/2020 at 15:46Environ. Res. Lett. 15(2020)024019 https: //doi.org /10.1088 /1748-9326 /ab68acLETTEREstimating and understanding crop yields with explainable deeplearning in the Indian Wheat BeltAleksandra Wolanin1,6, Gonzalo Mateo-García2, Gustau Camps-Valls2, Luis Gómez-Chova2,Michele Meroni3, Gregory Duveiller3, You Liangzhi4and Luis Guanter51Remote Sensing and Geoinformatics Section, GFZ German Research Centre for Geosciences, Helmholtz-Centre, Potsdam, Germany2Image Processing Laboratory, Universitat de València, València, Spain3European Commission, Joint Research Centre (JRC), Ispra, Italy4Environment and Production Technology Division, The International Food Policy Research Institute (IFPRI ), Washington, D.C., UnitedStates of America5Centro de Tecnologías Físicas, Universitat Politècnica de València, València, Spain6Author to whom any correspondence should be addressed.E-mail: ola@gfz-potsdam.de ,gonzalo.mateo-garcia@uv.es ,Gustau.Camps@uv.es ,luis.gomez-chova@uv.es ,Michele.meroni@ec.europa.eu ,Gregory.duveiller@ec.europa.eu ,l.you@cgiar.org andlguanter@ /uniFB01s.upv.esKeywords: wheat yield, Indian Wheat Belt, food security, remote sensing, explainable arti /uniFB01cial intelligence (XAI), deep learning (DL),regression activation map (RAM )Supplementary material for this article is available onlineAbstractForecasting crop yields is becoming increasingly important under the current context in which foodsecurity needs to be ensured despite the challenges brought by climate change, an expanding worldpopulation accompanied by rising incomes, increasing soil erosion, and decreasing water resources.Temperature, radiation, water availability and other environmental conditions in /uniFB02uence crop growth,development, and /uniFB01nal grain yield in complex nonlinear manner. Machine learning (ML)techniques, and deep learning (DL)methods in particular, can account for such nonlinear relationsbetween yield and its covariates. However, they typically lack transparency and interpretability, sincethe way the predictions are derived is not directly evident. Yet, in the context of yield forecasting,understanding which are the underlying factors behind both predicted loss or gain is of greatrelevance. Here, we explore how to bene /uniFB01t from the increased predictive performance of DL methodswhile maintaining the ability to interpret how the models achieve their results. To do so, we applied adeep neural network to multivariate time series of vegetation and meteorological data to estimate thewheat yield in the Indian Wheat Belt. Then, we visualized and analyzed the features and yield driverslearned by the model with the use of regression activation maps. The DL model outperformed othertested models (ridge regression and random forest )and facilitated the interpretation of variables andprocesses that lead to yield variability. The learned features were mostly related to the length of thegrowing season, and temperature and light conditions during this time. For example, our resultsshowed that high yields in 2012 were associated with low temperatures accompanied by sunnyconditions during the growing period. The proposed methodology can be used for other crops andregions in order to facilitate application of DL models in agriculture.1. IntroductionThe Food and Agriculture Organization (FAO)of theUnited Nations estimates that 50% more food needsto be produced by 2050 in order to feed the increasingworld population (FAO 2017 ). However, the ongoingefforts to increase food production are curbed byclimate change, which has already impacted globalmean yields of major crops in the last decades, and isfurther projected to negatively affect food security(FAO, IFAD, UNICEF, WFP and WHO 2018 Mbowet al2019 ). It is therefore crucial to not only accuratelyOPEN ACCESSRECEIVED21 October 2019REVISED17 December 2019ACCEPTED FOR PUBLICATION7 January 2020PUBLISHED11 February 2020Original content from thiswork may be used underthe terms of the CreativeCommons Attribution 4.0licence .Any further distribution ofthis work must maintainattribution to theauthor (s)and the title ofthe work, journal citationand DOI.© 2020 The Author (s). Published by IOP Publishing Ltdpredict crop yield, but also to model and characterizethe processes involved by understanding the meteor-ological drivers of crop yield variability.Meteorological variables in /uniFB02uence crop growth,development, and /uniFB01nal grain yield in nonlinear man-ner and often with complex interactions (Siebert et al2017 Akter and Ra /uniFB01qul Islam 2017 ). These variablesare accounted for in both process-based as well as sta-tistical models to estimate crop yield (e.g. Lobell et al2011 Iizumi et al 2018 ). While process-based modelsrequire detailed (and not always available )informa-tion on the farmers ’practices, recent increase in theavailability of global satellite observations andadvancements in statistical methods have fueled theapplication of machine learning (ML)models at var-ious scales (e.g. Lobell et al 2011 Guan et al 2017 Caiet al 2019 ). In particular, such models may have thecapability of accounting for additional factors redu-cing growth and yield (e.g. pests, diseases, weeds andother perils ).In order to better exploit the wealth of informationin the meteorological and satellite-derived vegetationdata, we propose to apply convolutional neural net-works (CNNs ), class of deep learning (DL)models(Goodfellow et al 2016 LeCun et al 2015). DL meth-ods promise great advances in Earth observation andgeosciences (Reichstein et al2019 ), as they can accountfor the large size of the input datasets, nonlinear rela-tions, and interconnections among multiple variables.Since CNNs can learn the features directly from thedata, this approach does not depend on the manualselection of speci /uniFB01c parameters.A major shortcoming of ML methods in general,and of DL methods in particular, is that the learnedrelations are hidden under very complicated predic-tion functions. However, recent years have seen theemergence of whole /uniFB01eld of ML called ‘ExplainableArti/uniFB01cial Intelligence ’to face this issue (Miller 2019 ),and techniques and methodologies have been intro-duced to study what the ML /DL models are learning(Montavon et al 2018 ). In this work, we focus on anef/uniFB01cient method to explain the model predictionscalled regression activation mapping (RAM )(Zhouet al 2016, Wang et al 2017 Wang and Yang 2017 ).RAM contains the immediate information for the /uniFB01nalprediction, but also maintains the correspondence tothe input data in the time (or spatial )dimension andshows the contribution of each time (or space )instantto the /uniFB01nal output. As result, we not only bene /uniFB01tfrom DL in terms of improvements in the model per-formance, but we speci /uniFB01cally focus on evaluating theunderlying drivers, thereby placing con /uniFB01dence in themodel as well as gaining insight into the relevant con-ditions leading to crop yield variability.Here, we focus on the wheat yield estimation in theIndian Wheat Belt, where concerns of yield stagnationhave risen due to increasingly inconsistent growthtrend of wheat yields in recent years (Rayet al 2012 ,Tripathi and Mishra 2017 ). High temperature hasbeen identi /uniFB01ed as the most detrimental factor, affect-ing both crop growth and grain formation (Lobell et al2012 Jain et al 2017 ), but also heavy and untimelyrainfall and hailstorm events have caused large-scaledamages to the crops (Singh et al2017 ). Finally, cloudyweather with high humidity and low temperaturesincreases chances of wheat diseases (e.g. wheat rustsand spot blotch )(Duveiller et al2007 Kaur et al2015 ),which have been spreading in India (Hodson 2011 ). Inaddition, in the speci /uniFB01c case of the double croppingsystem in India (typically rice-wheat ), the timing ofwheat sowing may be suboptimal because it is condi-tioned by local farming practices and by the timing ofthe rice harvest (Global Information and Early Warn-ing System on Food and Agriculture (GIEWS )2019 ).As the Indian Wheat Belt poses many challengesregarding complex processes and nonlinearities, itconstitutes good scenario to evaluate our approachthat could be eventually used in other similar settings.Therefore, the aims of the paper are two-fold:(1)to develop DL model for wheat yield estimationand evaluate its application for within-season yieldforecast, and (2)to scrutinize what this model learnedby visualizing and interpreting the drivers of yield esti-mation. This knowledge extraction process may haveimplications in further crop management actions, aswell as interactions with stakeholders and farmers.2. Materials and methodsOur analysis was performed in the Indian Wheat Beltregion, which supplies around 70% of India ’s totalwheat production (/uniFB01gure 1). We estimated district-level crop yield using as input set of time series ofmeteorological and satellite-derived vegetation vari-ables at daily resolution that are summarized intable 1and described in S1. In our analysis, we usedthree vegetation indices (VIs): the normalized differ-ence vegetation index (NDVI )(Tucker et al 1985), thenormalized difference water index (NDWI )(Gao 1996 ), and near-infrared re /uniFB02ectance of vegeta-tion (NIRv )(Badgley et al 2017 ); and seven environ-mental variables: minimum, mean and maximum airtemperatures (Tmin,Tmean,Tmax), downward short-wave radiation /uniFB02ux(SW down), water vapor pressurede/uniFB01cit(VPD ), precipitation, and day-length (table 1).Pixel level values of input variables were spatiallyaggregated to the district level as the weighted averageaccording to fractional area occupied by wheat in eachpixel (S1 in the supplementary information, availableonline at stacks.iop.org /ERL/15/024019 /mmedia ).The DL models (CNN )and the baseline models(ridge regression, RR, and random forest, RF )weretrained and tested on the dataset of 143 districts over13 years (2001 –2013)(S2). The time range of the ana-lysis was determined by the availability of bothMODIS imagery and wheat yield data for all states. Inthe standard setup, all districts were pooled together2Environ. Res. Lett. 15(2020)024019and separate model for each year was calculated,where data from this year were used for testing anddata from the rest of the years were used for training.The CNN model stacked one-dimensional con-volutional layers (Conv1D )along time dimension andmax pooling layers (MaxPool1D )with window sizeof/uniFB01ve(/uniFB01gure 2(a)). After the second Conv1D, the datawere fed into global average pooling layer (GAP),which computed the mean in the time dimension foreach variable. Finally, simple linear layer was appliedto obtain the /uniFB01nal yield prediction.We propose to use RAMs as tool to visualize andinterpret how the CNN models achieve their results.Activation mapping has been previously applied forimage analysis in the classi /uniFB01cation (Zhou et al2016)andregression problems (Wang and Yang 2017). Here, weshow their application on time series data, as inspiredby the application of class activation map to interpretthe temporal data in Wang et al(2017). For time seriesinput, the RAM is another time series such that its aver-age over time (plus bias )corresponds to the predictedoutput value. As result, RAM contains the immediateinformation for the /uniFB01nal prediction, but also maintainsthe correspondence between the last convolutionalfeature maps and the input data in the time dimension.RAM is calculated by combining the convoluted datathat is fed into GAP layer with the weights of the /uniFB01nallinear layer (/uniFB01gure 2(b)). In particular, if {z1,t,K,zd,t}are the input time series to the GAP layer, the output ofthe GAP layer is the mean over the time dimensionzT tit1,for each time series i/uniF0A0ä/uniF0A0{1,..,d}. The /uniFB01nal yieldprediction (yˆ)is then the linear combination of thoseaveraged time series:yTzw b1,1idtTit zi z,,/uni239B/uni239D/uni239C/uni239E/uni23A0/uni239F ()where wz,iandbzare respectively the weights and thebias of the output linear combination. In this setting,we de /uniFB01ne the RAM (rt)as the following time series:rz .2 tidit zi,, ()RAM satis /uniFB01es that yr bT ttz1ˆ Hence the RAMvalue at given time step rtcan be interpreted as anestimation of the derivative of the output w.r.t. time,xrdy dt ˆ and the /uniFB01nal estimation as the integral ofRAM, ¨yr dtT1ˆ () .The models were applied directly to the multivariatetime series of input variables (VIs and meteorologicaldata). The time period analyzed corresponded to245 days, starting from October 1st, that cover the rabigrowing season when wheat is grown. As result, eachinput for the DL model was tensor of size (245,nvars),where nvarsis number of input variables that varieddepending on the experiment. In case of the baselinemodels, the daily data was reshaped into vectors(of length qn 245 vars). Afterwards the baseline modelswere trained using those vectors as input and the /uniFB01nalyield as output. Application of RR and RF to monthlyaverages slightly increased model performance (S3).The model performances were compared amongCNNs, as well as the baseline models for three differentcombinations of the input data, with two, /uniFB01ve or teninput variables using the time series data only (‘No dis-trict’), as well as using additionally the district informa-tion as input (‘Incl. district ’)as in mixed-effects model(Wu2009).S e i /uniFB01cally, in the ‘Incl. district ’setting, weadded district-dependent bias in the last layer of theFigure 1. The study area of the Indian Wheat Belt region. The rabiseason cropland fraction for season 2007 –08 is shown for the fourwheat producing states used in this study (Punjab, Haryana, Uttar Pradesh, Bihar )in green. The circles represent the wheat yield forthe districts (delineated in gray )for the same season.3Environ. Res. Lett. 15(2020)024019Table 1. Main characteristics of the data used in this study. Most of the data was downloaded using the Google Earth Engine (GEE)cloud computing platform (Gorelick et al2017).Category Variables Spatial resolution Temporal resolution SourceSatellite observations of vegetation NDVI, NDWI, NIRv calculated from MODIS Bands1, and 7500 16 day resolution, day sampling MODIS MCD43A4 V6, exported from GEEMeteorological data Tmin,Tmean,Tmax, SW down, VPD 0.25 3 h, aggregated to daily values GLDAS-2.1, exported from GEEPrecipitation 0.05 Daily CHIRPS, exported from GEEDay-length District Daily Calculated between civil twilight before the sunrise and the end of civil twi-light after the sunsetCrop fraction Rabi season wheat crop fraction 5000 Yearly Annual Cropland Datasets of National Remote Sensing Centre in IndiaWheat yield data Rabi season wheat yield District Yearly Indiastat4Environ. Res. Lett. 15(2020)024019CNN model that was /uniFB01tted during the training process.The district information was represented in RR as anadditional binary class matrix, and in RF —as catego-rical variable. The best model architectures and hyper-parameters were determined as described in S3. In addi-tion, we compared the model performance to the nullmodel, in which the yield for each district for every yearwas calculated as the average of yields from the otheravailable years in the input dataset for this district (e.g.yield for the district Patiala in 2006 was calculated as themean of yields in Patiala for years 2003 –2005 and2007–2013). As next step, to evaluate what input para-meters were the most important for the wheat yield esti-mation, we run ensembles of /uniFB01ve CNN models in twosimple sets of varying combinations of input variables:(1)with one variable only (for all ten variables );a d(2)with two variables: VI +one meteorological para-meter (21 combinations ).Finally, two models where selected for RAM calcu-lations and visualizations: CNN with two input vari-ables, NDWI and Tmin(CNN 2), as well as all ten inputvariables (CNN 10), both including district informa-tion. These models were run in model ensembles often members each. In addition to creating separatemodel for each year (as previously ), we also re-trainedthese models on all the input data (CNN 2,all andCNN 10,all)in order to compare RAMs across differentyears created with the same model weights.Because our study compares many different mod-els, we chose to use single evaluation metric to sim-plify the process of model selection and thepresentation of the results. The selected metric is theNash –Sutcliffe ef /uniFB01ciency (NSE)( Nash and Sut-cliffe 1970 ), that provides an indication of the good-ness of /uniFB01t and can range fromdto 1, with the bestpossible score (1.0)meaning that modeled crop yieldsare equal to reported ones.3. Results3.1. Performance of the modelsThe performances measured as NSE for differentmodels and input datasets are compared for all yearsaveraged and for one year separately (2012 )in table 2.The results for 2012 were shown to demonstrate thatthe overall good performance among all years does notnecessarily guarantee accurate predictions for abnor-mal years. 2012 was peculiar year characterized byvery high yields compared to average (/uniFB01gure S8 ), asindicated by poor performance of the null model(table 2). CNN models provided the best results overall(best NSE of 0.868 among all years in the ‘Incl. district ’setting, compared to the best NSE of 0.757 for RR and0.836 for RF )that were stable among model runs (S4),which shows applicability of such models to densetime series for yield estimation. The null model wasalready good predictor for the yield among all years(NSE of 0.812 )and it performed better than any modelthat excluded district information, as the majority ofthe yield variation came from the spatial variation (S5).However, when considering the abnormal year 2012,the null model performed much worse than the othermodels (NSE of 0.288 ), which demonstrates theFigure 2. Convolutional neural network (CNN )architecture used in this study (a)and regression activation mapping (b). Thenumbers re /uniFB02ect the input data size, size of features during the model processing, and number of the /uniFB01lters used in the CNN model(with 10 input variables and district information, as in table S2 ), where the input for the DL model was tensor of size (245, 10 ), where245 corresponds to the length of the analyzed time period and 10 is the number of input variables.5Environ. Res. Lett. 15(2020)024019importance of using satellite observations to estimateyields for atypical years.3.2. Impact of input variables on the modelperformancePerformance of CNNs improved with the increase inthe number of input parameters, both in terms of thebest performing models, as well as among all testedmodel settings (table 2). When testing models withone or two variables to evaluate the parametersimportance, the model performance and variableranking were not consistent among the years, with2012 showing the worst performance (/uniFB01gures 3and4).The models performed much better and had smallerperformance variation if the information on thedistrict was included. However, in 2012, some modelcombinations gave better results without districtinformation, which is related to the fact that the nullmodel performed poorly for this year.In case of models with one variable only and nodistrict information (‘No district ’in/uniFB01gure 3), VIs per-formed better among all the parameters (and NDWIthe best ). Models with day-length as the only variablehad very good performance, even though thisparameter does not carry any information about thecrop condition. It suggests that the model was actuallytrying to learn the speci /uniFB01c day-length patterns relatedto districts, as yields have clear spatial pattern in thisregion (/uniFB01gure 1)that is somewhat similar to the latitu-dinal distribution of day-length (/uniFB01gure S9 ).When the district information was fed into themodel (‘Incl. district ’in/uniFB01gure 3), the best performingmodel across all years was the one using NDWI, fol-lowed closely by SW downand other VIs. The good per-formance of NDWI and SW down was reproduced formodels with two variables (/uniFB01gure 4). However, thisbehavior was not consistent among all the years forneither one- nor two-variable models. Good perfor-mance of NDWI and SW downin 2012 (/uniFB01gures 3and4)could be leading factor responsible for their highoverall ranking, as the differences among the modelsin this year were much larger than for other years. Forexample, in case of 2002, the ranking of pairs includ-ing NDWI and SW downwere among the worst, but thegeneral variability was very small. These results suggestthat accounting for various parameters is important,as the conditions that limit or boost the crop yieldsvary among the years.3.3. RAMs and their sensitivity to input variablesOverall, the main features of RAMs were the same forall the ensemble members (/uniFB01gure 5), as well as for themodels re-trained on all the input data (CNN 2,allandCNN 10,all). We compare in detail RAMs of the districtPatiala for 2006, for selected CNN models using two(CNN 2,all)or ten (CNN 10,all)input variables in/uniFB01gures 6(a)–(b). As mentioned before, the average ofRAM plus bias (bias both of the whole model and thedistrict-speci /uniFB01c, see S6 ), equals the estimated yield. Eventhough RAMs are products of the complex nonlinearinteractions of the input data, some basic patterns canbe directly inferred. For example, the overall shape ofRAMs is closely related to the growing cycle as shown byNDWI. In case of the 2-variable model (/uniFB01gure 6(a)), allobserved temporal patterns of RAM can be related toNDWI or Tmin, as these were the only input parameters.As result, small dip in RAM around day 100 can beassociated with the increase in Tmin, as NDWI duringthis time was steadily increasing, which suggests thenegative impact of higher Tminon the crop yield. Tosupport this claim, we modi /uniFB01edTminand calculated theresulting changes in RAMs as shown in /uniFB01gure6(c). Twosmall changes were performed on the Tmindata—in the/uniFB01rst case we removed the Tminpeak around day 100(shown in blue in /uniFB01gure6(c))and in the second case, weincreased Tminaround day 150 (shown in yellow in/uniFB01gure6(c)). The changes in the resulting RAMs —whichdirectly relate to changes in the estimated yield —arehighlighted in blue and yellow in /uniFB01gure 6(c). Thedecrease in Tminled to the increase in RAM andremoved the previously observed dip. On the otherhand, increase in Tminled to similar decrease in RAM,Table 2. Yield estimation performance for the testsub-sets using CNNs, ridge regression and randomforest at their best performing architectures fordifferent input variables combinations: input vars.(NDVI +Tmin), input vars. (NDVI, NDWI, Tmin,SW down, VPD ), 10 input vars. (NDVI, NDWI, NIRv,Tmin,Tmean,Tmax, SW down, VPD, precipitation, day-length ). Excluding or including district information(+district )refers to ‘No district ’or‘Incl. district ’settings, respectively.Model input vars.NSEAll years 2012CNN 0.663 0.251CNN 0.740 0.494CNN 10 0.788 0.625CNN +district 0.830 0.532CNN +district 0.862 0.741CNN 10 +district 0.868 0.743RR 0.734 0.418RR 0.744 0.436RR 10 0.756 0.432RR +district 0.737 0.421RR +district 0.746 0.438RR 10 +district 0.757 0.434RF 0.704 0.338RF 0.744 0.443RF 10 0.754 0.481RF +district 0.827 0.493RF +district 0.831 0.480RF 10 +district 0.836 0.453Null modela0.812 0.288aNull model is calculated for each district for everyyear as the average of yields from the remainingavailable years in this district.6Environ. Res. Lett. 15(2020)024019Figure 3. Model performance (NSE)for ensembles of /uniFB01ve CNN models with only one variable as the input for selected years andaveraged among all years. The results for two model settings are tested: ‘No district ’is using only one bias in the whole model in the/uniFB01nal layers, while in case of ‘Incl. district ’a bias per district (time-independent )is additionally /uniFB01tted during the training process.Figure 4. Model performance (NSE)for ensembles of /uniFB01ve CNN models with only two input variables (VI+meteorological variable )for selected years and averaged among all years. Only results for models including district information (‘Incl. district ’)are shown.Figure 5. Variability of regression activation maps calculated for different districts and years for different members in modelensemble of ten with ten input variables (a)–(c)or in model ensemble of ten with two input variables (d)–(f). The thin green lines(‘one year ’)correspond to models calculated for one year using other years as training, red lines (‘all years ’)correspond to modelstrained on the whole dataset, while the thick dashed lines (Mean of ‘all years ’)correspond to the average of the ‘all years ’models.7Environ. Res. Lett. 15(2020)024019and therefore decrease in the yield. However,analogous Tminmodi /uniFB01cations for CNN 10,allresulted indifferent magnitudes of changes in RAMs due todecrease or increase in Tmin. The increase in Tmintowards the end of the growing season had muchbigger impact on RAM than the decrease in Tminearlierin the growing season, which led to positive but verysmall change in RAM.To better identify the parameters and features thatled to certain responses in RAMs, we compared selec-ted input variables and RAMs for Patiala for two verydifferent years: the year 2006, when the yield was quitepoor (4.233 /ha), and 2012, when the yield was verygood (5.473 /ha)in/uniFB01gures 7(a)and(b). In 2006,RAM demonstrated overall lower values and manystrong drops, while in 2012, RAM showed consistentlyhigh values despite not much higher VIs. To analyzethe drivers of this variability, we exchanged, one inturn, four input variables (Tmin,Tmax, SW down, pre-cipitation )among 2006 and 2012 to check how thiswould affect changes in both RAMs and estimatedyields (/uniFB01gures 7(c)–(j)). For example, SW down wasmostly responsible for creating the dips in RAMs in2006 for Patiala —as many of them were /uniFB01lled whenSW down from 2012 was used, especially the big droparound day 160 (/uniFB01gure 7(g)). Overall, the yield in 2006increased using any of the input parameters from2012, but the highest increase was observed for Tmax,followed by SW down,Tminand only slightly for pre-cipitation. The same rank of variables in terms of themagnitude of the impact was observed in the case ofmodifying the input variables in 2012.Similar features were consistent among all districtsin 2006 and 2012, as shown by anomalies (positive inred, negative in blue )in RAM, NDWI, Tmax,TminandSW down in/uniFB01gure 8. In general, these years were rela-tively sunny, but in 2012, both TmaxandTminhadstrong negative anomalies during the second half ofthe growing season. The rapid and short negativeanomalies in RAMs were usually related to negativeanomalies in SW down (highlighted with green boxes ),which sometimes were also accompanied by positiveanomalies in Tmin(as cloudy skies capture the long-wave radiation emitted by Earth at night ). It is notedthat this link may lead to wrong interpretation of theeffect of Tmin, when considered alone (e.g. modelwith Tminas the only weather input ). Positive anoma-lies in RAM in 2012 were connected to strong negativeanomalies in TmaxandTmin(highlighted with magentaboxes ).3.4. Predictive skill of CNNsWe examined if our CNN model could be potentiallyuseful for predicting the yield during the growingseason by analyzing the impact of shortening the inputtime series in 25-day steps on the model performance.As compared to the null model, CNN 10had betterprediction from day 145, which corresponds to the lastweek of February (/uniFB01gure 9), In general, the month ofFebruary is the time of the anthesis stage, conditionsduring which are crucial for the /uniFB01nal crop yield.Therefore, covering this time period is essential for agood yield estimation. From day 195 (middle of April ),which widely corresponds to the harvest time in thisregion, the model performance did not increase.This suggests that after harvest the additional datawere not useful anymore for the yield estimation.Although this may seem trivial, it is neverthelessimportant that model performance appears insensitiveto post-harvest data, as adding such data could occurwhilst in an operational context.4. Discussion4.1. Application of DL models for yield estimationEven though our DL modeling approach was con-strained by the requirement for network explainability(global pooling layer after the convolutional layers tofacilitate RAMs ), it outperformed RF and RR in theFigure 6. Regression activation maps for Patiala (2006)for models with input of two (CNN 2,all)and ten (CNN 10,all )variables. OriginalRAMs ((a)and(b)), and changes in RAMs due to modi /uniFB01cation in Tmin((c)and(d))are shown. Colorful lines re /uniFB02ect the changes inTmin, while the highlighted areas correspond to changes in RAMs (that are directly transferred into changes in the estimated yield ).Tminand NDWI are scaled (as the input to CNNs ).8Environ. Res. Lett. 15(2020)024019yield estimation task, though RF provided strongperformance improvement as compared to RR.Although DL models are already widely used for avariety of problems in image and signal processingdomain (LeCun et al 2015 ), DL applications for cropyield estimation are still rare (e.g. You et al 2017 ,Crane-Droesch 2018 ), as the transfer of available toolsfrom the /uniFB01eld of ML into the environmental applica-tions requires adaptations that account for speci /uniFB01citiesof the data. Our results demonstrate that CNNs can bea valid tool for capturing complex processes inagricultural systems, and their application can betherefore further explored for other crops and regions.4.2. Impact of environmental conditions on the cropyield as captured by DLTo generalize well in the yield estimation problem, it isimportant to train models over several years andsimultaneously account for multiple vegetation andenvironmental variables, as the main yield drivers varyamong seasons. Since many of the input variables inthe crop yield models are correlated and inter-related,multiple parameters should be considered when tryingto understand the impact of variables on the crop yieldin the model. For example, the impact of Tminvarieddepending on whether it was the only input meteor-ological variable or one of many (/uniFB01gure 6).RAM ’s general shape re /uniFB02ected VIs, which empha-sizes the importance of the length of the growing per-iod and agrees with previous studies (Lobell et al2012 ,Jainet al2017 ). Meteorological variables used togetherwith VIs are expected to have only marginal contrib-ution to yield estimation, as their impact is alreadyre/uniFB02ected by vegetation growth that is captured by VIs.Overall, SW down turned out to be the most importantmeteorological variable for yield estimation, eventhough the ranking varied signi /uniFB01cantly among theyears. Comparison of performances among modelsFigure 7. Regression activation maps for Patiala for the model with input of ten variables (CNN 10,all). Original RAMs and scaled inputdata for year 2006 (a)and year 2012 (b). Modi /uniFB01ed input data and RAMs for year 2006 (c),(e),(g),(i)and 2012 (d),(f),(h),(j). Modi /uniFB01edinput parameters (imported from the other year )are shown in dashed red lines (c)–(j). Input parameters shown are scaled (z-score,therefore unitless ), while RAMs represent the intermediate step of the data processed in the model (in general unitless, but practicallyrelated to the yield in the yield units ).9Environ. Res. Lett. 15(2020)024019with one or two input variables, as well as the RAManalysis, showed that high yields in 2012 were asso-ciated with low temperatures accompanied by sunnyconditions during the growing period, though mostrecent studies focus primarily on the impact ofincreasing temperatures in the Indian Wheat Belt (e.g.Duncan et al2014 Jain et al2017 Song et al2018 )andin other regions (Lobell et al 2005 ). As an importantdriver of photosynthesis, SW downaffects the resourcesthat crops can build during the growing season, whichis apparently not fully re /uniFB02ected in the VIs. High radia-tion levels are also especially important during the cri-tical period for grain number determination (20–30days before anthesis to ten days afterwards )(Fischer 1985). Analysis of RAMs showed that themodel was trained to recognize events of decreasedlight as having negative impact on the crop yield,which suggests that the decline of photosynthesis dueFigure 8. Anomalies of RAMs and selected input variables for all districts for the years 2006 and 2012. Time series for each district areshown as rows, and columns correspond to time steps. Starting from the top, districts are located in states of Punjab, Haryana, UttarPradesh and Bihar. The anomalies were calculated by subtracting district-speci /uniFB01c multi-year averages from the scaled data for thegiven year. Positive anomalies are shown in red, negative in blue. The strong and rapid negative anomalies in RAMs that could berelated to negative anomalies in SW downare highlighted in green rectangles, while positive anomalies in 2012 that could be related tostrong negative anomalies in TmaxandTminare highlighted in magenta rectangles.Figure 9. Model performance (NSE)as function of changes in the end limit of the input data among all years. One CNN 10model wasretrained for each year separately for the input data shortened in 25-day steps. The shaded range of values corresponds to NSEvariability among different years.10Environ. Res. Lett. 15(2020)024019to decreased radiation was larger than the bene /uniFB01t dueto increased diffused light. This agrees with the nega-tive effects associated with reduction in sunlightshown on global scale (Proctor et al2018 ). Decreasedpenetration of sunlight for the crop has already spur-red demand for breeding for high photosynthetic orradiation-use ef /uniFB01ciency (Joshi et al2007 ). These obser-vations also suggest that sun-induced /uniFB02uorescencecould be good direct proxy for the crop yield, as itcarries information on light conditions, and was pre-viously shown to perform better than VIs for yield esti-mation (Song et al 2018 ). Although NIRv was foundsuperior to other VIs for estimating GPP (Badgley et al2017 ), we did not detect any bene /uniFB01t of using it for theyield estimation.4.3. Physical interpretability of RAMsThe novelty of our approach extends beyond obtaininga satisfactory model performance, as we adapted theactivation mapping to the regression problem for thetemporal data in order to localize important patternsfor the yield estimation. The analysis of RAMs appliedin the time dimension facilitates DL network inter-pretability and provides the needed transparency onwhat DL models learn and how they accomplish theirprediction. Analysis of the different patterns in RAMscan provide consistent description of how thenetwork captures the weather effects in relation to thetemporal progression of the crop, and can ultimatelylead to valid physical interpretation. The natural wayto interpret RAMs is to regard it as kind of derivativeof the yield function in time. In the global pooling layerthis function is then integrated out by the network toestimate the crop yield, which as result re /uniFB02ects theaccumulated effects of crop growth and meteorologi-cal conditions. Thus, the application of RAM allowsfor an instinctive analysis of how certain events in thetime domain impact the estimated crop yield andenables comparison with known drivers. In our case,RAMs were roughly re /uniFB02ecting the development of thecrop and at the same time were sensitive to thevariability of meteorological conditions, which some-how re /uniFB02ects the basic approach of relating yield to theaccumulated biomass. Such an approach can increasethe con /uniFB01dence in the model (as it captures theprocesses that are expected to be relevant ), but mightalso draw attention to so far neglected features ormodel weaknesses. For example, although high tem-peratures leading to low yields are often considered inthe Indian Wheat Belt, the importance of sunnyconditions for good yields is rather neglected. On theother hand, RAMs varying towards the end of theanalyzed time period might suggest that the model hasnot completely learned to ignore the time after theharvest. In general, the proposed methodology facil-itates the application of DL in agriculture, not only toimprove yield estimation and prediction but also togain insight into the key drivers of crop yield.AcknowledgmentsThe work by AW has been funded by the joint project ofInternational Cooperation and Exchange Programsbetween NSFC and DFG (41761134082 ). The work byGMG and LGC has been funded by the SpanishMinistry of Economy and Competitiveness (TEC2016-77741-R, ERDF ). The MODIS and GLDAS data used inthis study were acquired as part of the mission ofNASA ’s Earth Science Division and archived anddistributed by the Goddard Earth Sciences (GES)Dataand Information Services Center (DISC ).Data availability statementThe data that support the /uniFB01ndings of this study areavailable from the corresponding author upon reason-able request.ORCID iDsAleksandra Wolaninhttps: //orcid.org /0000-0002-9029-6911Gregory Duveillerhttps: //orcid.org /0000-0002-6471-8404ReferencesAkter and Ra /uniFB01qul Islam 2017 Heat stress effects andmanagement in wheat. review Agron. Sustain. Dev. 3737Badgley G, Field B and Berry A 2017 Canopy near-infraredre/uniFB02ectance and terrestrial photosynthesis Sci. Adv. 3e1602244Cai et al2019 Integrating satellite and climate data to predictwheat yield in australia using machine learning approachesAgric. For. Meteorol. 274144–59Crane-Droesch 2018 Machine learning methods for crop yieldprediction and climate change impact assessment inagriculture Environ. Res. Lett. 13114003Duncan M A, Dash and Atkinson M 2014 Elucidating theimpact of temperature variability and extremes on cerealcroplands through remote sensing Glob. Change Biol. 211541–51Duveiller E, Singh P and Nicol M 2007 The challenges ofmaintaining wheat productivity: pests, diseases, and potentialepidemics Euphytica 157417–30FAO 2017 The Future of Food and Agriculture —Trends andChallenges Rome, FAOFAO, IFAD, UNICEF, WFP and WHO 2018 The State of FoodSecurity and Nutrition in the World 2018. Building climateresilience for food security and nutrition Technical ReportRome, FAOFischer A 1985 Number of kernels in wheat crops and thein/uniFB02uence of solar radiation and temperature J. Agric. Sci. 105447–61Gao 1996 NDWI —A normalized difference water index forremote sensing of vegetation liquid water from space RemoteSens. Environ. 58257–66Global Information and Early Warning System on Food andAgriculture (GIEWS )2019 Giews crop prospects and foodsituation quarterly global report #1 march 2019 TechnicalReport Food and Agriculture Organization of the UnitedNations (http://www.fao.org /3/i9553en /i9553en.pdf )Goodfellow I, Bengio and Courville 2016 Deep Learning(Cambridge, MA: MIT Press )11Environ. Res. Lett. 15(2020)024019Gorelick N, Hancher M, Dixon M, Ilyushchenko S, Thau andMoore 2017 Google Earth Engine: planetary-scalegeospatial analysis for everyone Remote Sens. Environ. 20218–27Guan K, Wu J, Kimball S, Anderson C, Frolking S, Li B,Hain R and Lobell B 2017 The shared and unique valuesof optical, /uniFB02uorescence, thermal and microwave satellite datafor estimating large-scale crop yields Remote Sens. Environ.199333–49Hodson P 2011 Shifting boundaries: challenges for rustmonitoring Euphytica 17993–104Iizumi T, Shiogama H, Imada Y, Hanasaki N, Takikawa andNishimori 2018 Crop production losses associated withanthropogenic climate change for 1981-2010 compared withpreindustrial levels Int. J. Climatol. 385405 –17Jain M, Singh B, Srivastava A K, Malik K, McDonald J andLobell B 2017 Using satellite data to identify the causes ofand potential solutions for yield gaps in India ’s Wheat BeltEnviron. Res. Lett. 12094011Joshi K, Mishra B, Chatrath R, Ferrara O and Singh P 2007Wheat improvement in India: present status, emergingchallenges and future prospects Euphytica 157431–46Kaur P, Singh H, Rao U M, Hundal S, Sandhu S, Nayyar S,Rao B and Kaur 2015 Agrometeorology of wheat inPunjab state of India (https: //doi.org /10.13140 /RG.2.1.5105.6721 )LeCun Y, Bengio and Hinton 2015 Deep learning Nature 521436–44Lobell B, Ortiz-Monasterio I, Asner P, Matson A,Naylor L and Falcon P 2005 Analysis of wheat yield andclimatic trends in Mexico Field Crops Res. 94250–6Lobell B, Schlenker and Costa-Roberts 2011 Climate trendsand global crop production since 1980 Science 333616–20Lobell B, Sibley and Ortiz-Monasterio I 2012 Extreme heateffects on wheat senescence in India Nat. Clim. Change 2186–9Mbow et al2019 Food security Climate Change and Land: an IPCCspecial report on climate change, deserti /uniFB01cation, landdegradation, sustainable land management, food security, andgreenhouse gas /uniFB02uxes in terrestrial ecosystems ed R Shuktaet al(Geneva: Intergovernmental Panel on Climate Change(IPCC )) (https: //www.ipcc.ch /site/assets /uploads /sites/4/2019/11/08_Chapter-5.pdf )in pressMiller 2019 Explanation in arti /uniFB01cial intelligence: insights from thesocial sciences Artif. Intell. 2671–38Montavon G, Samek and Müller K-R 2018 Methods forinterpreting and understanding deep neural networks Digit.Signal Process. 731–15Nash and Sutcliffe 1970 River /uniFB02ow forecasting throughconceptual models: I. discussion of principles J. Hydrol. 10282–90Proctor J, Hsiang S, Burney J, Burke and Schlenker 2018Estimating global agricultural effects of geoengineering usingvolcanic eruptions Nature 560480–3Ray K, Ramankutty N, Mueller D, West C and Foley A 2012Recent patterns of crop yield growth and stagnation Nat.Commun. 31293Reichstein M, Camps-Valls G, Stevens B, Jung M, Denzler J,Carvalhais and Prabhat 2019 Deep learning and processunderstanding for data-driven Earth system science Nature566195–204Siebert S, Webber and Rezaei E 2017 Weather impacts on cropyields —searching for simple answers to complex problemEnviron. Res. Lett. 12081001Singh K, Saxena R, Porwal A, Neetu and Ray S 2017 Assessmentof hailstorm damage in wheat crop using remote sensingCurr. Sci. 1122095Song L, Guanter L, Guan K, You L, Huete A, Ju and Zhang 2018Satellite sun-induced chlorophyll /uniFB02uorescence detects earlyresponse of winter wheat to heat stress in the Indian Indo-Gangetic Plains Glob. Change Biol. 244023–37Tripathi and Mishra K 2017 The wheat sector in India:production, policies and food security The Eurasian WheatBelt and Food Security ed Gomez et al(Cham: Springer )pp 275 –96Tucker J, Townshend R and Goff E 1985 African land-coverclassi /uniFB01cation using satellite data Science 227369–75Wang Z, Yan and Oates 2017 Time series classi /uniFB01cation fromscratch with deep neural networks: strong baseline Proc. of theIEEE IJCNN (Anchorage, AK, 14 –19 May 2017) pp 1578 –85(https: //ieeexplore.ieee.org /document /7966039 )Wang and Yang 2017 Diabetic retinopathy detection via deepconvolutional networks for discriminative localization andvisual explanation arXiv: 1703.10757Wu 2009 Mixed Effects Models for Complex Data (Boca Raton, FL:CRC Press )You J, Li X, Low M, Lobell and Ermon 2017 Deep Gaussianprocess for crop yield prediction based on remote sensingdataProc. 31st AAAI Conf. on Arti /uniFB01cial Intelligence (AAAI-17)(https: //aaai.org /ocs/index.php /AAAI /AAAI17 /paper /view/14435 )Zhou B, Khosla A, Lapedriza A, Oliva and Torralba 2016Learning deep features for discriminative localization TheIEEE Conf. on Computer Vision and Pattern Recognition(CVPR) (https: //ieeexplore.ieee.org /document /7780688 )12Environ. Res. Lett. 15(2020)024019